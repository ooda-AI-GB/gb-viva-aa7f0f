{% extends "layout/base.html" %}

{% block content %}
<div style="margin-bottom: 20px;">
    <a href="/projects/{{ task.project_id }}" style="color: var(--text-secondary); text-decoration: none;">‚Üê Back to Project</a>
</div>

<div class="card" style="margin-bottom: 30px;">
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
        <div>
            <h1>{{ task.title }}</h1>
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <span class="badge badge-{{ task.status }}">{{ task.status|replace('_', ' ') }}</span>
                <span class="badge badge-{{ task.priority }}">{{ task.priority }}</span>
            </div>
            <p style="color: var(--text-secondary);">{{ task.description if task.description else 'No description' }}</p>
        </div>
        <div>
            <!-- Actions like delete task? -->
        </div>
    </div>
    
    <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 0;">
        <div style="text-align: center;">
            <div class="stat-value">{{ task.assigned_to if task.assigned_to else 'Unassigned' }}</div>
            <div class="stat-label">Assigned To</div>
        </div>
        <div style="text-align: center;">
            <div class="stat-value">{{ task.due_date if task.due_date else 'No date' }}</div>
            <div class="stat-label">Due Date</div>
        </div>
        <div style="text-align: center;">
            <div class="stat-value">{{ task.actual_hours }} / {{ task.estimated_hours if task.estimated_hours else '0' }}</div>
            <div class="stat-label">Hours (Act / Est)</div>
        </div>
    </div>
</div>

<div class="grid" style="grid-template-columns: 2fr 1fr; gap: 30px;">
    <!-- Time Entries -->
    <div>
        <div class="card">
            <h3>Time Log</h3>
            {% if task.time_entries %}
            <table style="width: 100%; margin-top: 15px;">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>User</th>
                        <th>Hours</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in task.time_entries %}
                    <tr>
                        <td>{{ entry.date }}</td>
                        <td>{{ entry.user_id }}</td>
                        <td>{{ entry.hours }}</td>
                        <td>{{ entry.description }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No time logged yet.</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Log Time Form -->
    <div>
        <div class="card">
            <h3>Log Time</h3>
            <form action="/tasks/{{ task.id }}/log-time" method="POST" style="margin-top: 15px;">
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" name="date_logged" class="form-control" id="log-date" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Hours</label>
                    <input type="number" step="0.5" name="hours" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea name="description" class="form-control" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Log Time</button>
            </form>
        </div>
    </div>
</div>

<script>
    document.getElementById('log-date').valueAsDate = new Date();
</script>
{% endblock %}
