{% extends "layout/base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h1>Dashboard</h1>
    <a href="/projects/new" class="btn btn-primary">New Project</a>
</div>

<!-- Quick Stats -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">{{ stats.total_projects }}</div>
        <div class="stat-label">Total Projects</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.active_tasks }}</div>
        <div class="stat-label">Active Tasks</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.hours_logged }}</div>
        <div class="stat-label">Hours Logged (Week)</div>
    </div>
    <div class="stat-card" style="border-color: {% if stats.overdue_items > 0 %}var(--danger){% else %}var(--border){% endif %};">
        <div class="stat-value" style="color: {% if stats.overdue_items > 0 %}var(--danger){% else %}var(--text-primary){% endif %};">{{ stats.overdue_items }}</div>
        <div class="stat-label">Overdue Items</div>
    </div>
</div>

<div class="grid" style="grid-template-columns: 2fr 1fr; gap: 30px;">
    <!-- Project Overview & Tasks -->
    <div>
        <div class="card">
            <h3>Project Status</h3>
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                {% for status, count in project_counts.items() %}
                <div style="flex: 1; text-align: center; padding: 10px; background: var(--bg-light); border-radius: 6px;">
                    <div style="font-weight: 700; font-size: 1.25rem;">{{ count }}</div>
                    <div class="badge badge-{{ status }}">{{ status|replace('_', ' ') }}</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="card">
            <h3>My Tasks</h3>
            {% if tasks_by_status.items()|length == 0 %}
                <p>No tasks found.</p>
            {% else %}
                {% for status, tasks in tasks_by_status.items() %}
                    {% if tasks %}
                        <h4 style="margin-top: 15px; text-transform: capitalize; color: var(--text-secondary);">{{ status|replace('_', ' ') }}</h4>
                        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 10px;">
                            {% for task in tasks %}
                            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 8px;">
                                <div>
                                    <a href="/tasks/{{ task.id }}" style="text-decoration: none; color: var(--text-primary); font-weight: 500;">{{ task.title }}</a>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">
                                        Project ID: {{ task.project_id }} • Due: {{ task.due_date if task.due_date else 'No date' }}
                                    </div>
                                </div>
                                <span class="badge badge-{{ task.priority }}">{{ task.priority }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
    </div>

    <!-- Sidebar: Upcoming & Activity -->
    <div>
        <div class="card">
            <h3>Upcoming Deadlines (7 Days)</h3>
            {% if upcoming %}
                <ul class="timeline" style="margin-top: 20px;">
                {% for item in upcoming %}
                    <li class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div style="font-weight: 600;">{{ item.title }}</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">
                            {{ item.type }} • Due {{ item.due_date }}
                        </div>
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <p style="color: var(--text-secondary);">No upcoming deadlines.</p>
            {% endif %}
        </div>

        <div class="card">
            <h3>Recent Activity</h3>
            {% if recent_activity %}
                <div style="display: flex; flex-direction: column; gap: 15px;">
                {% for entry in recent_activity %}
                    <div style="border-left: 3px solid var(--primary); padding-left: 10px;">
                        <div style="font-size: 0.9rem;">Logged {{ entry.hours }}h</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">{{ entry.description[:50] }}...</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">{{ entry.date }}</div>
                    </div>
                {% endfor %}
                </div>
            {% else %}
                <p style="color: var(--text-secondary);">No recent activity.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
